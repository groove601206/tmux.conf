# =========================
# PATH & Shell (cross-platform)
# =========================
set-environment -g PATH "$HOME/bin:$PATH"

# Detect platform
if-shell 'uname | grep -qi Darwin' 'set -g @platform macOS' 'set -g @platform Linux'
if-shell 'grep -qi microsoft /proc/version 2>/dev/null' 'set -g @platform WSL'

# Set default shell based on platform
if-shell '[ "$(tmux show-option -gqv @platform)" = "macOS" ]' \
  "if-shell 'test -x /bin/zsh' 'set -g default-shell /bin/zsh'" \
  "set -g default-shell $SHELL"

if-shell '[ "$(tmux show-option -gqv @platform)" = "Linux" ]' \
  "if-shell 'test -x /usr/bin/zsh' 'set -g default-shell /usr/bin/zsh'" \
  "set -g default-shell $SHELL"

if-shell '[ "$(tmux show-option -gqv @platform)" = "WSL" ]' \
  "if-shell 'test -x /usr/bin/zsh' 'set -g default-shell /usr/bin/zsh'" \
  "set -g default-shell $SHELL"

set -g default-command $SHELL

# =========================
# Basic settings
# =========================
set-option -g default-terminal 'screen-256color'
set-option -g terminal-overrides ',xterm-256color:RGB'

set -g prefix C-a
set -g base-index 1
set -g detach-on-destroy off
set -g escape-time 0
set -g history-limit 1000000
set -g renumber-windows on
set -g set-clipboard on
set -g status-position top
setw -g mode-keys vi
set -g pane-active-border-style 'fg=magenta,bg=default'
set -g pane-border-style 'fg=brightblack,bg=default'

# =========================
# Keybindings
# =========================
unbind %
bind | split-window -h
unbind '"'
bind - split-window -v
unbind r
bind r source-file ~/.tmux.conf
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5
bind -r m resize-pane -Z
bind-key K display-popup -w 40% -E "sesh connect \"$(sesh list -i | gum filter --limit 1 --placeholder 'Pick a session' --prompt 'âš¡')\""
bind s choose-tree -sZ -O name
set-window-option -g mode-keys vi
bind-key -T copy-mode-vi v send -X begin-selection
bind-key -T copy-mode-vi y send -X copy-selection
unbind -T copy-mode-vi MouseDragEnd1Pane

# =========================
# Plugins
# =========================
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'fcsonline/tmux-thumbs'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'wfxr/tmux-fzf-url'
set -g @plugin 'omerxx/catppuccin-tmux'
set -g @plugin 'omerxx/tmux-sessionx'
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @plugin 'omerxx/tmux-floax'
set -g @plugin 'jrgirvan/tmux-meetings'

# =========================
# Resurrect & Continuum settings
# =========================
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-restore 'on'

# =========================
# Initialize TPM
# =========================
run '~/.tmux/plugins/tpm/tpm'
